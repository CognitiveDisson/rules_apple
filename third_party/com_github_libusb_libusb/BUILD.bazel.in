CONFIG = [
    "'DEFAULT_VISIBILITY=__attribute__((visibility(\"default\")))'",
    "ENABLE_LOGGING=1",
    "HAVE_DECL_TFD_CLOEXEC=0",
    "HAVE_DECL_TFD_NONBLOCK=0",
    "HAVE_DLFCN_H=1",
    "HAVE_INTTYPES_H=1",
    "HAVE_MEMORY_H=1",
    "HAVE_POLL_H=1",
    "HAVE_STDINT_H=1",
    "HAVE_STDLIB_H=1",
    "HAVE_STRINGS_H=1",
    "HAVE_STRING_H=1",
    "HAVE_STRUCT_TIMESPEC=1",
    "HAVE_SYS_STAT_H=1",
    "HAVE_SYS_TIME_H=1",
    "HAVE_SYS_TYPES_H=1",
    "HAVE_UNISTD_H=1",
    "'LT_OBJDIR=\".libs/\"'",
    "OS_DARWIN=1",
    "'PACKAGE=\"libusb\"'",
    "'PACKAGE_BUGREPORT=\"libusb-devel@lists.sourceforge.net\"'",
    "'PACKAGE_NAME=\"libusb\"'",
    "'PACKAGE_STRING=\"libusb=1.0.22\"'",
    "'PACKAGE_TARNAME=\"libusb\"'",
    "'PACKAGE_URL=\"http://libusb.info\"'",
    "'PACKAGE_VERSION=\"1.0.22\"'",
    "POLL_NFDS_TYPE=nfds_t",
    "STDC_HEADERS=1",
    "THREADS_POSIX=1",
    "'VERSION=\"1.0.22\"'",
    "_GNU_SOURCE=1",
]

genrule(
    name = "config_h",
    outs = ["libusb/config.h"],
    cmd = "touch $@",
)

cc_library(
    name = "libusb",
    copts = ["-D" + d for d in CONFIG],
    srcs = glob(["libusb/*.c"]) + [
        ":config_h",
        "libusb/os/darwin_usb.c",
        "libusb/os/poll_posix.c",
        "libusb/os/threads_posix.c",
    ],
    hdrs = glob(["libusb/*.h"]) + [
        "libusb/os/darwin_usb.h",
        "libusb/os/poll_posix.h",
        "libusb/os/threads_posix.h",
    ],
    linkopts = ["-framework IOKit"],
    alwayslink = 1,
    linkstatic = 1,
    includes = ["libusb"],
    visibility = ["//visibility:public"],
)
