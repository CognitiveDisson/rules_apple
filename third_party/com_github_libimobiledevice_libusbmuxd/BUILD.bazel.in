CONFIG = [
    "HAVE_CLOCK_GETTIME=1",
    "HAVE_DLFCN_H=1",
    "HAVE_INTTYPES_H=1",
    "HAVE_LOCALTIME_R=1",
    "HAVE_MALLOC=1",
    "HAVE_MEMORY_H=1",
    "HAVE_REALLOC=1",
    "HAVE_STDINT_H=1",
    "HAVE_STDLIB_H=1",
    "HAVE_STPCPY=1",
    "HAVE_STPNCPY=1",
    "HAVE_STRCASECMP=1",
    "HAVE_STRDUP=1",
    "HAVE_STRERROR=1",
    "HAVE_STRINGS_H=1",
    "HAVE_STRING_H=1",
    "HAVE_STRNDUP=1",
    "HAVE_SYS_STAT_H=1",
    "HAVE_SYS_TYPES_H=1",
    "HAVE_UNISTD_H=1",
    "'LT_OBJDIR=\".libs/\"'",
    "'PACKAGE=\"libusbmuxd\"'",
    "'PACKAGE_BUGREPORT=\"https://github.com/libimobiledevice/libusbmuxd/issues\"'",
    "'PACKAGE_NAME=\"libusbmuxd\"'",
    "'PACKAGE_STRING=\"libusbmuxd 1.1.1\"'",
    "'PACKAGE_TARNAME=\"libusbmuxd\"'",
    "'PACKAGE_URL=\"http://libimobiledevice.org\"'",
    "'PACKAGE_VERSION=\"1.1.1\"'",
    "STDC_HEADERS=1",
    "'VERSION=\"1.1.1\"'",
]

cc_library(
    name = "common",
    srcs = glob(["common/*.c"]),
    hdrs = glob(["common/*.h"]),
    includes = ["common"],
    linkstatic = 1,
    visibility = ["//visibility:public"],
)

cc_library(
    name = "libusbmuxd",
    srcs = glob(["src/*.c"]),
    hdrs = glob(["include/*.h"]),
    includes = ["include"],
    copts = ["-D" + d for d in CONFIG],
    deps = [
        ":common",
        "@com_github_libimobiledevice_libplist//:libplist",
    ],
    linkstatic = 1,
    visibility = ["//visibility:public"],
)
